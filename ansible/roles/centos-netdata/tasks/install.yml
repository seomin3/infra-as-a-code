---

- name: download install script
  get_url:
    url: https://my-netdata.io/kickstart.sh
    dest: /root/netdata.sh
    validate_certs: no
    mode: 0700

- command: which netdata
  register: which_result
  ignore_errors: yes

- name: install netdata
  command: bash /root/netdata.sh --non-interactive
  register: bash_result
  when: which_result.rc != 0

- name: allow 19999 port
  iptables:
    action: insert
    rule_num: 10
    chain: INPUT
    protocol: tcp
    destination_port: 19999
    jump: ACCEPT
    state: present
  ignore_errors: yes
